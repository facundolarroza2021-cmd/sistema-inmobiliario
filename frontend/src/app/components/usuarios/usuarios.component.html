<div class="container-usuario">
  <mat-card class="card-usuario mat-elevation-z8">
    <mat-card-header class="card-header-flex">
      <mat-icon color="accent">person_add</mat-icon>
      <mat-card-title>Registro de Nuevo Usuario</mat-card-title>
      <mat-card-subtitle>Crea accesos y asigna permisos a tu equipo de trabajo.</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="usuarioForm" (ngSubmit)="onSubmit()" class="responsive-form">

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nombre Completo</mat-label>
          <input matInput formControlName="name" placeholder="Ej: Juan Pérez">
          <mat-icon matSuffix>person</mat-icon>
          <mat-error *ngIf="usuarioForm.get('name')?.hasError('required')">El nombre es obligatorio.</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Correo Electrónico</mat-label>
          <input matInput formControlName="email" type="email" placeholder="usuario@sistema.com">
          <mat-icon matSuffix>email</mat-icon>
          <mat-error *ngIf="usuarioForm.get('email')?.hasError('required')">El correo es obligatorio.</mat-error>
          <mat-error *ngIf="usuarioForm.get('email')?.hasError('email')">Formato de correo inválido.</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Rol / Permisos</mat-label>
          <mat-select formControlName="role" required>
            @for (rol of roles; track rol.value) {
              <mat-option [value]="rol.value">{{ rol.viewValue }}</mat-option>
            }
          </mat-select>
          <mat-icon matSuffix>vpn_key</mat-icon>
          <mat-error *ngIf="usuarioForm.get('role')?.hasError('required')">El rol es obligatorio.</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Contraseña</mat-label>
          <input matInput formControlName="password" [type]="showPassword ? 'text' : 'password'">
          <button type="button" mat-icon-button matSuffix (click)="showPassword = !showPassword" [attr.aria-label]="'Ocultar Contraseña'" [attr.aria-pressed]="showPassword">
            <mat-icon>{{showPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>
          <mat-error *ngIf="usuarioForm.get('password')?.hasError('required')">La contraseña es obligatoria.</mat-error>
          <mat-error *ngIf="usuarioForm.get('password')?.hasError('minlength')">Debe tener al menos 8 caracteres.</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Confirmar Contraseña</mat-label>
          <input matInput formControlName="password_confirmation" [type]="showPassword ? 'text' : 'password'">
          <mat-error *ngIf="usuarioForm.get('password_confirmation')?.hasError('required')">Debe confirmar la contraseña.</mat-error>
          <mat-error *ngIf="usuarioForm.hasError('notSame') && usuarioForm.get('password_confirmation')?.touched">
            Las contraseñas no coinciden.
          </mat-error>
        </mat-form-field>

        <button mat-raised-button 
                color="primary" 
                type="submit" 
                [disabled]="usuarioForm.invalid || isSaving" 
                class="full-width submit-button">
          <mat-icon>save</mat-icon>
          {{ isSaving ? 'Guardando...' : 'CREAR USUARIO' }}
        </button>

      </form>
    </mat-card-content>
  </mat-card>
</div>