<h2 mat-dialog-title class="dialog-title-cobro">
    <mat-icon color="primary" class="me-2">receipt_long</mat-icon> Registro de Cobro Múltiple
</h2>

<mat-dialog-content class="mat-typography dialog-content-cobro">
    
    <div class="summary-box mb-4 p-3 rounded-3 shadow-sm">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="text-muted fw-medium">Cuotas seleccionadas:</span>
            <span class="fw-bold">{{ cuotasSeleccionadas.length }} items</span>
        </div>
        
        <mat-divider class="mb-3"></mat-divider>
        
        <div class="d-flex justify-content-between align-items-center">
            <span class="fs-5 fw-bold text-dark">Total Adeudado:</span>
            <strong class="fs-4 fw-bolder total-deuda">$ {{ totalCuotas | number:'1.2-2' }}</strong>
        </div>
    </div>

    <mat-card class="p-4 form-card-cobro">
        <h4 class="fw-bold text-dark mb-4 border-bottom pb-2">Datos de la Transacción</h4>
        
        <form (ngSubmit)="procesarCobro()">
            
            <mat-form-field appearance="outline" class="w-100 mb-3 field-monto">
                <mat-label>Monto Recibido</mat-label>
                <input matInput type="number" [(ngModel)]="montoFinal" name="montoFinal" required 
                       placeholder="Monto exacto del pago" 
                       class="monto-input text-primary"> 
                <mat-icon matSuffix>attach_money</mat-icon>
                <mat-error *ngIf="montoFinal > totalCuotas">
                    El monto excede la deuda total.
                </mat-error>
                <mat-hint>Ingrese el monto total recibido para aplicar a las cuotas.</mat-hint>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-100 mb-3">
                <mat-label>Forma de Pago</mat-label>
                <mat-select [(ngModel)]="formaPago" name="formaPago" required>
                    <mat-option value="Efectivo">Efectivo</mat-option>
                    <mat-option value="Transferencia">Transferencia Bancaria</mat-option>
                    <mat-option value="Cheque">Cheque</mat-option>
                </mat-select>
            </mat-form-field>
            
            <mat-form-field appearance="outline" class="w-100 mb-0">
                <mat-label>Observaciones (Opcional)</mat-label>
                <textarea matInput [(ngModel)]="observacion" name="observacion" rows="3"></textarea>
            </mat-form-field>
        </form>
    </mat-card>
    
    <div *ngIf="cargando" class="text-center mt-4">
        <mat-spinner diameter="30" color="primary"></mat-spinner>
        <p class="mt-2 text-primary">Procesando pago...</p>
    </div>

</mat-dialog-content>

<mat-dialog-actions align="end" class="dialog-actions-cobro">
    <button mat-button (click)="onNoClick()" [disabled]="cargando">Cancelar</button>
    <button mat-raised-button color="primary" 
            (click)="procesarCobro()" 
            [disabled]="montoFinal <= 0 || montoFinal > totalCuotas || cargando" 
            class="btn-confirm-cobro">
        <mat-icon>check_circle</mat-icon> Confirmar Pago
    </button>
</mat-dialog-actions>